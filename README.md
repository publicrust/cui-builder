# CUI Builder

Визуальный редактор для создания пользовательских интерфейсов в стиле Unity UI для игры Rust.

## Бизнес-задача

CUI Builder - это инструмент для визуального создания и редактирования пользовательских интерфейсов в формате CUI (Custom User Interface) для игры Rust. Он позволяет разработчикам плагинов создавать сложные интерфейсы без необходимости писать JSON вручную.

### Основные возможности

- Визуальное создание и редактирование UI элементов
- Поддержка всех стандартных CUI компонентов
- Экспорт в JSON формат, совместимый с Rust Oxide
- Система якорей и отступов в стиле Unity
- Предпросмотр интерфейса в реальном времени

## Архитектура

Проект построен по принципам Feature-Sliced Design (FSD) с четким разделением ответственности.

### Слои архитектуры

```
src/
├── shared/           # Переиспользуемые сущности
│   ├── ui/          # UI компоненты
│   ├── lib/         # Библиотеки
│   └── api/         # API интерфейсы
├── entities/         # Бизнес-сущности
│   ├── cui-element/
│   │   ├── model.rs      # Структура CuiElement
│   │   ├── components/   # Компоненты CuiElement
│   │   └── lib.rs        # Публичное API
│   └── cui-container/
│       ├── model.rs      # Структура CuiElementContainer
│       └── lib.rs
├── features/         # Функциональность
│   ├── element-tree/     # Дерево элементов
│   ├── properties/      # Панель свойств
│   └── canvas/          # Канвас редактор
└── widgets/          # Композитные компоненты
    ├── canvas/
    │   ├── container.rs  # CuiElementContainer
    │   └── element.rs    # CuiElement
    └── sidebar/
```

### Ключевые сущности

#### CuiElement
Базовый элемент интерфейса, который может содержать различные компоненты.

```rust
pub struct CuiElement {
    pub name: String,          // Уникальное имя элемента
    pub parent: String,        // Имя родительского элемента
    pub destroy_ui: Option<String>,  // UI для уничтожения
    pub components: Vec<Box<dyn ICuiComponent>>,  // Компоненты
    pub fade_out: f32,         // Время затухания
    pub update: bool,          // Флаг обновления
}
```

#### CuiElementContainer
Контейнер элементов, представляющий собой корневой элемент UI.

```rust
pub struct CuiElementContainer {
    pub elements: Vec<CuiElement>,  // Список элементов
}
```

### Компоненты

Все компоненты реализуют интерфейс `ICuiComponent`:

```rust
pub trait ICuiComponent {
    fn component_type(&self) -> &'static str;
}
```

Основные типы компонентов:
- RectTransform (позиционирование и размеры)
- Image (изображения)
- RawImage (необработанные изображения)
- Text (текст)
- Button (кнопки)
- NeedsCursor (поддержка курсора)
- NeedsKeyboard (поддержка клавиатуры)

### Зависимости

#### Внешние зависимости
- Yew (веб-фреймворк)
- Serde (сериализация)
- wasm-bindgen (интеграция с JavaScript)
- web-sys (веб API)

#### Внутренние зависимости

1. **CuiElementContainer**
   - Зависит от: CuiElement
   - Используется в: Canvas, ElementTree

2. **CuiElement**
   - Зависит от: ICuiComponent
   - Используется в: CuiElementContainer, Properties

3. **Компоненты**
   - Зависят от: ICuiComponent
   - Используются в: CuiElement, Properties

## Функциональность

### Canvas
- Отображение элементов
- Поддержка перетаскивания
- Визуализация якорей
- Масштабирование и панорамирование

### Element Tree
- Иерархическое отображение элементов
- Drag & Drop для реорганизации
- Выделение активного элемента

### Properties Panel
- Редактирование свойств элементов
- Настройка компонентов
- Предпросмотр изменений

## Процесс разработки

1. **Этап 1: Базовая структура**
   - Реализация базовых сущностей
   - Настройка FSD архитектуры
   - Базовая функциональность Canvas

2. **Этап 2: Компоненты**
   - Реализация всех типов компонентов
   - Система свойств
   - Панель Properties

3. **Этап 3: Взаимодействие**
   - Drag & Drop
   - Якоря и отступы
   - Масштабирование и панорамирование

4. **Этап 4: Экспорт**
   - Генерация JSON
   - Валидация
   - Предпросмотр

## Дополнительные возможности

- Темы оформления
- Шаблоны элементов
- История изменений (Undo/Redo)
- Горячие клавиши
- Сохранение/загрузка проектов 